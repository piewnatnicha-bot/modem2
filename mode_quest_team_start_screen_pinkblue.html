<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Mode Quest ‚Äì ‡πÄ‡∏Å‡∏°‡∏ê‡∏≤‡∏ô‡∏ô‡∏¥‡∏¢‡∏°‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡∏° (‡∏°‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --pink: #ffb7d5;
      --pink-light: #ffe3f0;
      --blue: #b3d9ff;
      --blue-light: #e5f2ff;
      --text-dark: #4a4a4a;
    }
    * {
      box-sizing: border-box;
    }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 16px;
      background: linear-gradient(135deg, var(--pink-light), var(--blue-light));
    }
    .container {
      max-width: 520px;
      margin: 0 auto;
      background: #ffffff;
      padding: 20px 18px 18px;
      border-radius: 18px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.12);
      border: 3px solid var(--pink);
    }
    h1 {
      font-size: 22px;
      text-align: center;
      margin-bottom: 6px;
      color: #d63384;
      font-weight: 700;
    }
    h2 {
      font-size: 17px;
      margin-top: 16px;
      margin-bottom: 8px;
      color: #6f42c1;
    }
    p, label {
      font-size: 14px;
      color: var(--text-dark);
    }
    .section-card {
      margin-top: 10px;
      padding: 12px;
      border-radius: 12px;
      background: var(--pink-light);
      border: 2px solid var(--pink);
    }
    .section-card.blue {
      background: var(--blue-light);
      border-color: var(--blue);
    }
    .inputs-row {
      display: flex;
      gap: 4px;
      margin: 8px 0 12px;
    }
    .inputs-row input {
      width: 100%;
      padding: 8px;
      font-size: 16px;
      border-radius: 10px;
      border: 2px solid var(--blue);
      background: #ffffff;
      text-align: center;
    }
    .label {
      font-size: 14px;
      margin-top: 4px;
      margin-bottom: 4px;
      font-weight: 600;
    }
    .text-input, .answer-input, textarea {
      width: 100%;
      padding: 8px;
      font-size: 14px;
      border-radius: 10px;
      border: 2px solid var(--blue);
      background: #ffffff;
    }
    textarea {
      resize: vertical;
      min-height: 50px;
    }
    .no-mode-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 6px;
      font-size: 13px;
    }
    .no-mode-row input[type="checkbox"] {
      width: 18px;
      height: 18px;
    }
    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }
    button {
      flex: 1;
      padding: 10px;
      font-size: 15px;
      border: none;
      border-radius: 999px;
      cursor: pointer;
      color: #ffffff;
      font-weight: 600;
    }
    .btn-primary {
      background: #ff80bf;
    }
    .btn-secondary {
      background: #9ecbff;
      color: #003366;
    }
    .btn-warning {
      background: #ffaf4d;
      color: #4e2a00;
    }
    .btn-small {
      flex: none;
      padding: 6px 10px;
      font-size: 12px;
      border-radius: 999px;
    }
    .btn-outline {
      background: #ffffff;
      color: #1565c0;
      border: 2px solid #90caf9;
    }
    .result {
      margin-top: 16px;
      padding: 12px;
      border-radius: 12px;
      font-size: 14px;
      border: 2px solid;
    }
    .result.correct {
      background: #e6ffea;
      border-color: #66cc88;
      color: #1b5e20;
    }
    .result.incorrect {
      background: #ffe6eb;
      border-color: #ff99aa;
      color: #b71c1c;
    }
    .result.neutral {
      background: #f3f3f3;
      border-color: #cccccc;
    }
    .small {
      font-size: 12px;
      color: #777;
      margin-top: 2px;
    }
    .scoreboard {
      margin-top: 12px;
      padding: 12px;
      border-radius: 12px;
      background: var(--blue-light);
      border: 2px solid var(--blue);
    }
    .scoreboard-title {
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 15px;
      color: #0d47a1;
    }
    .scoreboard-row {
      display: flex;
      justify-content: space-between;
      margin: 2px 0;
      font-size: 14px;
    }
    .team-name-display {
      font-weight: 600;
      font-size: 15px;
      color: #0b3c8c;
      margin-top: 4px;
    }
    .history-container {
      margin-top: 8px;
      max-height: 220px;
      overflow-y: auto;
      border-radius: 10px;
      border: 1px solid #e0e0e0;
      background: #ffffff;
      padding: 6px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 4px;
      text-align: left;
      vertical-align: top;
    }
    th {
      background: #fde2ff;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    .chip-correct {
      color: #1b5e20;
      font-weight: 600;
    }
    .chip-incorrect {
      color: #b71c1c;
      font-weight: 600;
    }
    .credit {
      margin-top: 18px;
      text-align: center;
      font-size: 12px;
      color: #555;
      background: var(--blue-light);
      padding: 10px;
      border-radius: 12px;
      border: 2px solid var(--blue);
      font-weight: 600;
    }
    .badge-pill {
      display: inline-block;
      background: #ffd6f2;
      color: #c2185b;
      padding: 2px 10px;
      border-radius: 999px;
      font-size: 11px;
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Mode Quest ‚Äì ‡πÄ‡∏Å‡∏°‡∏ê‡∏≤‡∏ô‡∏ô‡∏¥‡∏¢‡∏°‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡∏°</h1>
    <p style="text-align:center; font-size:13px;">
      ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡∏π‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏•‡πà‡∏≤‡∏ê‡∏≤‡∏ô‡∏ô‡∏¥‡∏¢‡∏°‡∏Å‡∏±‡∏ô‡∏ô‡∏∞ üíñ
    </p>

    <!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏° -->
    <div id="startSection" class="section-card blue">
      <h2>üë• ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ‚Äú‡∏ó‡∏µ‡∏°‚Äù ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏•‡πà‡∏ô</h2>
      <p class="label">‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏° / ‡∏´‡∏°‡∏π‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
      <input id="teamName" class="text-input" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ó‡∏µ‡∏°‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏™‡∏≤‡∏¢‡∏ü‡πâ‡∏≤ ‡∏´‡πâ‡∏≠‡∏á ‡∏°.2/1">
      <p class="label" style="margin-top:6px;">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏ô‡∏ó‡∏µ‡∏°</p>
      <textarea id="teamMembers" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏ô‡∏ó‡∏µ‡∏° ‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏û‡∏£‡∏ß, ‡πÇ‡∏ö, ‡πÅ‡∏ö‡∏á‡∏Ñ‡πå"></textarea>
      <p class="small">
        ‚úî ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ 1 ‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÉ‡∏ä‡πâ 1 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏ä‡πà‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡∏Ñ‡∏¥‡∏î‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏≠‡∏ö<br>
        ‚úî ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏õ‡∏Å‡∏±‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π
      </p>
      <div class="buttons">
        <button class="btn-primary" onclick="startGame()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏ê‡∏≤‡∏ô‡∏ô‡∏¥‡∏¢‡∏° ‚ñ∂</button>
      </div>
    </div>

    <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏°‡∏´‡∏•‡∏±‡∏Å: ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏° -->
    <div id="gameSection" style="display:none; margin-top:12px;">
      <div class="scoreboard">
        <div class="scoreboard-title">üéÆ ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡∏°</div>
        <div id="teamNameDisplay" class="team-name-display">‡∏ó‡∏µ‡∏°: -</div>
        <div class="scoreboard-row">
          <span>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</span>
          <span id="totalScore">0</span>
        </div>
        <div class="scoreboard-row">
          <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô</span>
          <span id="roundCount">0</span>
        </div>
        <div class="scoreboard-row">
          <span>‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô (‡∏™‡∏ï‡∏£‡∏µ‡∏Ñ)</span>
          <span id="streak">0</span>
        </div>
        <div class="scoreboard-row">
          <span>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏≠‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</span>
          <span id="lastScore">-</span>
        </div>
        <span class="badge-pill">‡∏¢‡∏¥‡πà‡∏á‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡πÑ‡∏ß & ‡∏ñ‡∏π‡∏Å‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏≠‡∏ö ‚Üí ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏¢‡∏¥‡πà‡∏á‡∏™‡∏π‡∏á!</span>
      </div>

      <h2>1Ô∏è‚É£ ‡∏ä‡∏∏‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏° (5 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)</h2>
      <p class="small">
        ‡∏Å‡∏î ‚Äú‡∏™‡∏∏‡πà‡∏°‡∏ä‡∏∏‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡∏°‡πà‚Äù ‡πÅ‡∏•‡πâ‡∏ß‡∏ä‡πà‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏ó‡∏µ‡∏°‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÑ‡∏´‡∏ô‡∏ã‡πâ‡∏≥ ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÑ‡∏´‡∏ô‡∏ã‡πâ‡∏≥‡πÄ‡∏•‡∏¢
      </p>

      <div class="inputs-row">
        <input id="n1" type="number" inputmode="numeric" placeholder="‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 1">
        <input id="n2" type="number" inputmode="numeric" placeholder="‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 2">
        <input id="n3" type="number" inputmode="numeric" placeholder="‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 3">
        <input id="n4" type="number" inputmode="numeric" placeholder="‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 4">
        <input id="n5" type="number" inputmode="numeric" placeholder="‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 5">
      </div>

      <div class="buttons">
        <button class="btn-primary" onclick="randomizeNumbers()">üé≤ ‡∏™‡∏∏‡πà‡∏°‡∏ä‡∏∏‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡∏°‡πà</button>
        <button class="btn-secondary" onclick="clearNumbers()">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</button>
      </div>

      <h2>2Ô∏è‚É£ ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏°</h2>
      <p class="label">‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ê‡∏≤‡∏ô‡∏ô‡∏¥‡∏¢‡∏°‡∏Ç‡∏≠‡∏á‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ</p>
      <input id="answer" class="answer-input" type="number" inputmode="numeric" placeholder="‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡∏ê‡∏≤‡∏ô‡∏ô‡∏¥‡∏¢‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)">
      <div class="no-mode-row">
        <input type="checkbox" id="noMode" onchange="toggleNoMode()">
        <label for="noMode">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ê‡∏≤‡∏ô‡∏ô‡∏¥‡∏¢‡∏° (‡∏ó‡∏∏‡∏Å‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢)</label>
      </div>

      <div class="buttons">
        <button class="btn-primary" onclick="checkMode()">‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏°</button>
        <button class="btn-warning" onclick="resetGame()">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡∏°</button>
      </div>

      <div id="result" class="result neutral" style="display:none;"></div>

      <div class="section-card" style="margin-top:14px;">
        <h2>üìä ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏°‡∏ô‡∏µ‡πâ</h2>
        <p class="small">
          ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏î ‚Äú‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏°‚Äù<br>
          ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏ö‡∏Ñ‡∏≤‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏ó‡∏µ‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏î ‚Äú‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î CSV‚Äù ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π‡πÑ‡∏î‡πâ
        </p>
        <div class="buttons" style="margin-top:8px;">
          <button class="btn-secondary btn-small" onclick="toggleHistory()">‡πÅ‡∏™‡∏î‡∏á / ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
          <button class="btn-secondary btn-small" onclick="downloadCSV()">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå CSV</button>
        </div>
        <div id="historyContainer" class="history-container" style="display:none;">
          <div id="historyContent" class="small">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡πÉ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</div>
        </div>
      </div>
    </div>

    <!-- CREDIT SECTION -->
    <div class="credit">
      ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢<br>
      <strong>‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ô‡∏¥‡∏ä‡∏≤ ‡∏ú‡∏¥‡∏ß‡∏ó‡∏≠‡∏á‡∏á‡∏≤‡∏°</strong><br>
      ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏±‡∏î‡∏´‡∏ô‡∏≠‡∏á‡∏°‡∏∞‡∏Ñ‡πà‡∏≤
    </div>
  </div>

  <script>
    let startTime = null;
    let totalScore = 0;
    let roundCount = 0;
    let streak = 0;
    let attemptLog = [];

    function startGame() {
      const name = document.getElementById('teamName').value.trim();
      const members = document.getElementById('teamMembers').value.trim();

      if (!name) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏ô‡∏∞‡∏Ñ‡∏∞');
        return;
      }

      document.getElementById('startSection').style.display = 'none';
      document.getElementById('gameSection').style.display = 'block';
      updateTeamNameDisplay(name);
    }

    function updateTeamNameDisplay(name) {
      const display = document.getElementById('teamNameDisplay');
      if (name && name.trim() !== '') {
        display.textContent = '‡∏ó‡∏µ‡∏°: ' + name.trim();
      } else {
        display.textContent = '‡∏ó‡∏µ‡∏°: -';
      }
    }

    function getNumbers() {
      const ids = ['n1', 'n2', 'n3', 'n4', 'n5'];
      const nums = [];
      for (const id of ids) {
        const val = document.getElementById(id).value;
        if (val !== '') {
          const num = Number(val);
          if (!Number.isNaN(num)) {
            nums.push(num);
          }
        }
      }
      return nums;
    }

    function calculateMode(numbers) {
      const freq = {};
      numbers.forEach(n => {
        freq[n] = (freq[n] || 0) + 1;
      });

      let maxCount = 0;
      for (const key in freq) {
        if (freq[key] > maxCount) maxCount = freq[key];
      }

      if (maxCount <= 1) {
        return { modes: [], maxCount: 1, hasMode: false };
      }

      const modes = Object.keys(freq)
        .filter(key => freq[key] == maxCount)
        .map(k => Number(k));

      return { modes, maxCount, hasMode: true };
    }

    function randomizeNumbers() {
      const min = 1;
      const max = 20;
      const ids = ['n1', 'n2', 'n3', 'n4', 'n5'];
      ids.forEach(id => {
        const rand = Math.floor(Math.random() * (max - min + 1)) + min;
        document.getElementById(id).value = rand;
      });
      document.getElementById('answer').value = '';
      document.getElementById('noMode').checked = false;
      toggleNoMode();
      const resultBox = document.getElementById('result');
      resultBox.style.display = 'none';
      resultBox.textContent = '';
      startTime = Date.now();
    }

    function clearNumbers() {
      const ids = ['n1', 'n2', 'n3', 'n4', 'n5'];
      ids.forEach(id => document.getElementById(id).value = '');
      document.getElementById('answer').value = '';
      document.getElementById('noMode').checked = false;
      toggleNoMode();
      const resultBox = document.getElementById('result');
      resultBox.style.display = 'none';
      resultBox.textContent = '';
      startTime = null;
    }

    function toggleNoMode() {
      const noMode = document.getElementById('noMode').checked;
      const answerInput = document.getElementById('answer');
      if (noMode) {
        answerInput.value = '';
        answerInput.disabled = true;
        answerInput.placeholder = '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ê‡∏≤‡∏ô‡∏ô‡∏¥‡∏¢‡∏°';
      } else {
        answerInput.disabled = false;
        answerInput.placeholder = '‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡∏ê‡∏≤‡∏ô‡∏ô‡∏¥‡∏¢‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)';
      }
    }

    function updateScoreboard(lastScoreValue = null) {
      document.getElementById('totalScore').textContent = totalScore;
      document.getElementById('roundCount').textContent = roundCount;
      document.getElementById('streak').textContent = streak;
      document.getElementById('lastScore').textContent =
        lastScoreValue === null ? '-' : lastScoreValue;
    }

    function checkMode() {
      const resultBox = document.getElementById('result');
      const numbers = getNumbers();

      if (numbers.length === 0) {
        resultBox.style.display = 'block';
        resultBox.className = 'result neutral';
        resultBox.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡πà‡∏≤ ‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ô‡∏∞ üôÇ';
        return;
      }

      const { modes, maxCount, hasMode } = calculateMode(numbers);
      const noModeChecked = document.getElementById('noMode').checked;
      const studentVal = document.getElementById('answer').value;

      if (!noModeChecked && studentVal === '') {
        resultBox.style.display = 'block';
        resultBox.className = 'result neutral';
        resultBox.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡∏ê‡∏≤‡∏ô‡∏ô‡∏¥‡∏¢‡∏° ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ê‡∏≤‡∏ô‡∏ô‡∏¥‡∏¢‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡πà‡∏∞';
        return;
      }

      let elapsedSec = null;
      if (startTime !== null) {
        elapsedSec = (Date.now() - startTime) / 1000;
      }

      let isCorrect = false;
      let studentAnswer = null;

      if (!hasMode) {
        isCorrect = noModeChecked;
      } else {
        if (noModeChecked) {
          isCorrect = false;
        } else {
          studentAnswer = Number(studentVal);
          isCorrect = modes.includes(studentAnswer);
        }
      }

      roundCount += 1;

      let roundScore = 0;
      let timeScore = 0;
      let bonus = 0;
      let details = '';

      if (isCorrect) {
        if (elapsedSec === null) {
          timeScore = 10;
        } else if (elapsedSec <= 5) {
          timeScore = 30;
        } else if (elapsedSec <= 10) {
          timeScore = 20;
        } else if (elapsedSec <= 20) {
          timeScore = 10;
        } else {
          timeScore = 5;
        }

        streak += 1;
        if (streak >= 3) {
          bonus = 10;
        }

        roundScore = timeScore + bonus;
        totalScore += roundScore;

        resultBox.style.display = 'block';
        resultBox.className = 'result correct';

        details += '‚è± ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏°: ' + (elapsedSec !== null ? elapsedSec.toFixed(1) + ' ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ' : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '<br>';
        details += '‚≠ê ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡∏•‡∏≤: ' + timeScore + ' ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô<br>';
        if (bonus > 0) {
          details += 'üî• ‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏™‡∏ï‡∏£‡∏µ‡∏Ñ (‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô ' + streak + ' ‡∏Ñ‡∏£‡∏±‡πâ‡∏á): +' + bonus + ' ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô<br>';
        }

        if (hasMode) {
          resultBox.innerHTML =
            '‚úÖ ‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!<br>' +
            '‡∏ê‡∏≤‡∏ô‡∏ô‡∏¥‡∏¢‡∏°‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠: <strong>' + modes.join(', ') + '</strong><br>' +
            details +
            '<strong>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏°: ' + roundScore + ' ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</strong>';
        } else {
          resultBox.innerHTML =
            '‚úÖ ‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏∏‡∏î‡∏ô‡∏µ‡πâ <strong>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ê‡∏≤‡∏ô‡∏ô‡∏¥‡∏¢‡∏°</strong><br>' +
            '<span class="small">‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ó‡∏∏‡∏Å‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡πÄ‡∏û‡∏µ‡∏¢‡∏á 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</span><br>' +
            details +
            '<strong>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏°: ' + roundScore + ' ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</strong>';
        }

        updateScoreboard(roundScore);
      } else {
        streak = 0;
        roundScore = 0;

        resultBox.style.display = 'block';
        resultBox.className = 'result incorrect';

        details += '‚è± ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏°: ' + (elapsedSec !== null ? elapsedSec.toFixed(1) + ' ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ' : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '<br>';

        if (hasMode) {
          resultBox.innerHTML =
            '‚ùå ‡∏ï‡∏≠‡∏ö‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å ‡∏•‡∏≠‡∏á‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏ó‡∏µ‡∏°‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡∏ô‡∏∞<br>' +
            details +
            '‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏ê‡∏≤‡∏ô‡∏ô‡∏¥‡∏¢‡∏°‡∏Ñ‡∏∑‡∏≠: <strong>' + modes.join(', ') + '</strong><br>' +
            '<span class="small">‡∏Ñ‡πà‡∏≤‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ' + maxCount + ' ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>';
        } else {
          resultBox.innerHTML =
            '‚ùå ‡∏ï‡∏≠‡∏ö‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å ‡∏•‡∏≠‡∏á‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏ó‡∏µ‡∏°‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡∏ô‡∏∞<br>' +
            details +
            '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏∏‡∏î‡∏ô‡∏µ‡πâ <strong>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ê‡∏≤‡∏ô‡∏ô‡∏¥‡∏¢‡∏°</strong><br>' +
            '<span class="small">‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ó‡∏∏‡∏Å‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡πÄ‡∏û‡∏µ‡∏¢‡∏á 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</span>';
        }

        updateScoreboard(roundScore);
      }

      logAttempt({
        teamName: document.getElementById('teamName').value.trim(),
        teamMembers: document.getElementById('teamMembers').value.trim(),
        timestamp: new Date().toLocaleString('th-TH'),
        round: roundCount,
        numbers: numbers.slice(),
        hasMode: hasMode,
        correctModes: hasMode ? modes.slice() : [],
        correctHasMode: hasMode,
        studentAnswer: studentAnswer,
        studentNoMode: noModeChecked,
        isCorrect: isCorrect,
        elapsedSec: elapsedSec,
        roundScore: roundScore,
        totalScoreAfter: totalScore
      });

      startTime = null;
    }

    function logAttempt(entry) {
      attemptLog.push(entry);
      renderHistory();
    }

    function renderHistory() {
      const container = document.getElementById('historyContent');
      if (attemptLog.length === 0) {
        container.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡πÉ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ';
        return;
      }

      let html = '<table><thead><tr>' +
        '<th>‡∏£‡∏≠‡∏ö</th>' +
        '<th>‡πÄ‡∏ß‡∏•‡∏≤</th>' +
        '<th>‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</th>' +
        '<th>‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡∏°</th>' +
        '<th>‡πÄ‡∏â‡∏•‡∏¢‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</th>' +
        '<th>‡∏ñ‡∏π‡∏Å/‡∏ú‡∏¥‡∏î</th>' +
        '<th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏≠‡∏ö</th>' +
        '</tr></thead><tbody>';

      attemptLog.forEach(a => {
        const nums = a.numbers.join(', ');
        let teamAnswerText = '';
        if (a.studentNoMode) {
          teamAnswerText = '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ê‡∏≤‡∏ô‡∏ô‡∏¥‡∏¢‡∏°';
        } else if (a.studentAnswer !== null && a.studentAnswer !== undefined) {
          teamAnswerText = String(a.studentAnswer);
        } else {
          teamAnswerText = '-';
        }

        let correctText = '';
        if (!a.correctHasMode) {
          correctText = '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ê‡∏≤‡∏ô‡∏ô‡∏¥‡∏¢‡∏°';
        } else {
          correctText = a.correctModes.join(', ');
        }

        const correctnessChip = a.isCorrect
          ? '<span class="chip-correct">‡∏ñ‡∏π‡∏Å</span>'
          : '<span class="chip-incorrect">‡∏ú‡∏¥‡∏î</span>';

        html += '<tr>' +
          '<td>' + a.round + '</td>' +
          '<td>' + a.timestamp + '</td>' +
          '<td>' + nums + '</td>' +
          '<td>' + teamAnswerText + '</td>' +
          '<td>' + correctText + '</td>' +
          '<td>' + correctnessChip + '</td>' +
          '<td>' + a.roundScore + '</td>' +
          '</tr>';
      });

      html += '</tbody></table>';
      container.innerHTML = html;
    }

    function toggleHistory() {
      const box = document.getElementById('historyContainer');
      if (box.style.display === 'none' || box.style.display === '') {
        box.style.display = 'block';
        renderHistory();
      } else {
        box.style.display = 'none';
      }
    }

    function downloadCSV() {
      if (attemptLog.length === 0) {
        alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î');
        return;
      }

      const teamName = document.getElementById('teamName').value.trim() || 'no_teamname';
      const safeTeamName = teamName.replace(/[^‡∏Å-‡∏Æ‡∏∞-‡πôa-zA-Z0-9_-]+/g, '_');

      const header = [
        'team_name',
        'team_members',
        'round',
        'timestamp',
        'numbers',
        'has_mode',
        'correct_modes',
        'correct_has_mode',
        'student_answer',
        'student_selected_no_mode',
        'is_correct',
        'elapsed_seconds',
        'round_score',
        'total_score_after_round'
      ];

      const rows = [header.join(',')];

      attemptLog.forEach(a => {
        const row = [
          '"' + (a.teamName || '').replace(/"/g, '""') + '"',
          '"' + (a.teamMembers || '').replace(/"/g, '""') + '"',
          a.round,
          '"' + a.timestamp.replace(/"/g, '""') + '"',
          '"' + a.numbers.join(' ') + '"',
          a.hasMode ? 'TRUE' : 'FALSE',
          '"' + (a.correctModes.join(' ') || '') + '"',
          a.correctHasMode ? 'TRUE' : 'FALSE',
          (a.studentAnswer !== null && a.studentAnswer !== undefined) ? a.studentAnswer : '',
          a.studentNoMode ? 'TRUE' : 'FALSE',
          a.isCorrect ? 'TRUE' : 'FALSE',
          a.elapsedSec !== null && a.elapsedSec !== undefined ? a.elapsedSec.toFixed(2) : '',
          a.roundScore,
          a.totalScoreAfter
        ];
        rows.push(row.join(','));
      });

      const csvContent = rows.join('\n');
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);

      const link = document.createElement('a');
      link.href = url;
      const fileName = 'mode_quest_log_' + safeTeamName + '.csv';
      link.download = fileName;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }

    function resetGame() {
      totalScore = 0;
      roundCount = 0;
      streak = 0;
      attemptLog = [];
      updateScoreboard(null);
      clearNumbers();
      renderHistory();
    }

    // ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    updateScoreboard(null);
  </script>
</body>
</html>
